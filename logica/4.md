## Funcionalidad del componente Layout

**Prop√≥sito general**: El componente `Layout` funciona como un proveedor de contexto de autorizaci√≥n y sesi√≥n para sus componentes hijos, utiliza un mecanismo con un token de autorizaci√≥n que el servidor devuelve al iniciar sesi√≥n, y un token de sesi√≥n que se env√≠a al servidor con cada solicitud posterior para autenticarlas. Estos tokens y la moneda son estados internos y al modificarlos se mantienen sincronizados con el almacenamiento local del navegador para la persistencia de datos.
Este componente expone solo ciertas funciones y estados a los componentes hijos y mantiene para si los mecanismos de manejo de estado en relaci√≥n con la autorizaci√≥n, sobre todo al iniciar la aplicaci√≥n y al ocurrir ciertos cambios en el estado interno.

**Desglose de funciones:  ‚öôÔ∏è**

updateCurrency(token) => {}
Llama al servidor para obtener la informaci√≥n actualizada de la moneda actual y la actualiza en el LocalStorage en caso de que sea diferente.

setCurrency(token, id, session) => {}
Llama al servidor para cambiar la moneda seleccionada por el usuario. Al terminar actualiza los tokens de autorizaci√≥n y/o sesi√≥n.

getToken() => {}
Llama al servidor con los datos de inicio de sesi√≥n del usuario para obtener un nuevo token de sesi√≥n y lo actualiza en el estado.

autoConnectSession(first = false) => {}
Obtiene el token de autorizaci√≥n del almacenamiento del navegador, si este existe, se verifica y refresca con una llamada al servidor que devuelve un objeto con los token de autorizaci√≥n y sesi√≥n que se usan para actualizar los estados correspondientes. En caso de que no exista el token se desconecta la sesi√≥n. 

refreshToken(token) => {}
Llama al servidor para refrescar el token de sesi√≥n y modificar su estado.

getGeoInfo() => {}
Obtiene el c√≥digo de pa√≠s mediante una API y lo setea en el servidor.

disconnectSession() => {}
Elimina del estado los tokens de sesi√≥n y la informaci√≥n de la sesi√≥n del usuario y llama a la funcion getToken()
	
 

 **Flujos: üåä**
 
Aqui se define el proceso de autenticaci√≥n y autorizaci√≥n, con el uso de las funciones anteriormente seleccionadas.

- Al cargar la pagina y por unica vez
		- Si el token de autorizaci√≥n existe y no hay sesi√≥n del usuario: Se autentica el usuario mediante el token y se obtiene el token de sesi√≥n y los datos de sesi√≥n del usuario, tambi√©n se setea la moneda actual en el servidor mientras esta exista.
		- Sino: Se refresca el token y se setea la moneda actual en el servidor mientras esta exista 
		- En ambos casos: se actualiza la moneda actual

- Al cargar la pagina y cada vez que el token de sesion cambie de estado:
		- Si el token existe: Se obtienen los datos de 'Home' y la lista de productos
		- Sino: se obtiene el token de sesi√≥n mediante la funci√≥n getToken(), esto disparara otra vez este flujo iterativamente.

*(Esto es un poco complicado de explicar as√≠ y es mas complejo que esto, un diagrama de flujo quiz√°s? üôÉ )*

Lo dem√°s esta relacionado con la localizaci√≥n y como el sitio redirige al usuario a una configuraci√≥n del sitio de acuerdo a su idioma.



**RESUMEN**

El componente es un proveedor de mecanismos de autenticaci√≥n, autenticaci√≥n y localizaci√≥n. Envuelve los procesos necesarios para su funcionamiento y expone a sus elementos hijos solamente lo necesario para hacer sus propias solicitudes con los datos brindados, o para desconectar o reiniciar la sesi√≥n.


**Observaciones y recomendaciones: üîç**

- Un componente de 200 lineas es bastante grande, y tiene demasiadas funciones definidas en su cuerpo... podria considerarse el uso de custom Hooks para extraer parte de la l√≥gica.
- Una libreria de manejo de estado como RTK o Zustand podria ser util para manejar estados complejos como el de este componente, entonces las funciones y los estados podrian moverse a la definicion de las stores.
- Los tokens deberian tener nombres autodescriptivos.
- Podria simplificarse bastante usando solo un token (el de autenticacion) para todo el proceso (Al menos las apps que he creado antes, solo usaban un token y creo que es algo comun).
- Usar cookies con las flags 'httpOnly' y 'secure' puede ser mas seguro que almacenar los tokens en el LocalStorage 

- El c√≥digo es un poco confuso, es dif√≠cil saber bien que esta pasando con tantas funciones, la vista salta de aqu√≠ para all√° üòµ‚Äçüí´.
- Los tokens de autorizaci√≥n y sesi√≥n son exactamente iguales, 
es decir en el componente se utiliza el mismo dato del servidor para llenar ambos tokens... eso es normal? ü§îüòÖ.
- El nombre tan parecido del token de sesi√≥n (auth) con el token de autenticaci√≥n (auth_token) hace que se confundan f√°cilmente, y el nombre del de sesi√≥n no es autodescriptivo (esa es su funci√≥n... cierto? ü•∫).
 
				
	
